## How we manage a lot of manifests?
マニフェストをどのように管理するかは、Kubernetes を運用していく上で重要な課題の一つである。メジャーなツールとしては `kustomize` や `Helm` があるが、今回は `kustomize` を選んだ。以下では、そもそもマニフェスト管理ツールに求めていた要素は何だったのか、どのような体験を理想としていたのか、などを説明していく。

## What we look for in a manifest management tool
まず、マニフェスト管理ツールに求めていた要素は以下の通りである。

- 学習コストがそこまで高くない
- 最終的に生成されるマニフェストが確認できる（+ 予測しやすい）
- 環境差分が分かりやすい
- デプロイが高速かつ簡単に行える

まず、学習コストがそこまで高くないことが重要である。なぜなら、このリポジトリで想定している企業ではアプリケーションエンジニアが積極的にマニフェストを書く方針だったからである。この文脈における学習コストとは、主に「独自の概念や記法を学ぶコスト」を指している。独自の概念や記法がなければ、最低限のYAMLと Kubernetes の知識でマニフェストが書ける。マニフェストを書くコストが増加すると、アプリケーションの開発速度に影響が出てしまうため、望ましくない。

次に、最終的に生成されるマニフェストが確認できることが重要である。これは単純に最終的にデプロイされるマニフェストをレビューで確認したいからである。「ここの値を変更したらこーゆー感じのマニフェストが生成される**だろう**」ではなく「ここの値を変更したらこーゆー感じのマニフェストが生成され**た**」という事実をデプロイ前に確認したい。もっと言えば、書いている時点で最終的に生成されるマニフェストが予測しやすい方がアプリケーションエンジニアには優しいと言えるだろう（これは独自記法の有無などとも強く関係してくる）。

また、環境差分が分かりやすいことも大事である。そもそも、マニフェスト管理ツールを導入する大きな動機の一つが、「環境差分を分かりやすくすること」であった。新しく入ったエンジニアが「production と development ではここの値を変えているんだな」というのがパッと見で分かるような体験が欲しかった。例えば、本番環境ではHPAを設定しているけど開発環境ではレプリカ数を固定しているんだな、みたいなことを理解するのが容易であってほしい。マニフェストは肥大化する可能性が常にあるため、環境差分を目を凝らして探し出すことは避けたい。

最後に、デプロイが高速かつ簡単に行えることが望ましい。今回のインフラは ArgoCDによってデプロイされることが決定しているため、GitOps や ArgoCD との親和性が高く、かつデプロイフローを簡単に保つことが望ましい。デプロイフローの複雑化はデプロイ速度にも影響する。